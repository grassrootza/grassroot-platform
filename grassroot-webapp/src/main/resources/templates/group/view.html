<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
      data-layout-decorate="~{layout}">
<head>
  <title th:text="${group.name}">Group name</title>

  <link rel="stylesheet" type="text/css" th:href="@{/css/jquery-ui.min.css}" />
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

  <style type="text/css">
    /* Fix for UL/UI autocomplete in modal */
    .ui-autocomplete {
      z-index: 5000;
    }
  </style>

</head>
<body>

<!-- Group information -->
<section layout:fragment="header" class="top-container">
  <div class="container">

    <div class="row">
      <div class="col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-12">
        <h2 class="text-center"><span class="group-title">Group: </span><span class="group-name" th:text="${group.groupName}">Group</span></h2>
      </div>
    </div>

    <div class="row">
      <div class="col-md-4 col-md-offset-4 col-xs-12">
        <h4 class="text-center group-infp">
          Created on <span th:text="${#temporals.format(group.getCreatedDateTimeAtSAST(),'d MMM yyyy')}">Some date</span>.
          <span th:if="${openToken and canAlter}">Join code: <a href="javascript:void(0)" data-toggle="modal" data-target="#joiningModal">
            *134*1994*<span th:text="${group.groupTokenCode}">1234</span>#</a>
          </span>
          <span th:if="${openToken and not canAlter}">
            Join code: *134*1994*<span th:text="${group.groupTokenCode}">1234</span>#
          </span>
          <span th:unless="${openToken}">No open join code
          <a href="javascript:void(0)" data-toggle="modal" data-target="#joiningModal">(create one)</a></span>
        </h4>
        <h4 class="text-center group-info">
          <span th:if="${group.discoverable}">Group is public. </span>
          <span th:unless="${group.discoverable}">Group is private. </span>
          <a th:if="${canAlter}" href="javascript:void(0)" th:text="${group.discoverable ? 'Make private.' : 'Make public.'}" data-toggle="modal" data-target="#publicModal">Change this</a>
        </h4>
        <h4 th:if="${openToken and not #lists.isEmpty(flyerLanguages)}" class="text-center group-info">
          <a  href="javascript:void(0)" data-toggle="modal" data-target="#flyerModal">Generate flyer</a>
        </h4>
        <div th:if="${canAlter}" class="dropdown manage-container">
          <button class="dropdown-toggle white-button group-center-button" type="button" data-toggle="dropdown">Manage and modify group<i class="fa fa-caret-down" aria-hidden="true"></i></button>
          <ul class="dropdown-menu">
            <li><a th:href="@{/group/roles/members(groupUid=${group.uid})}">Change members' roles</a></li>
            <li><a th:if="${canChangePermissions}" th:href="@{/group/roles/permissions(groupUid=${group.Uid})}">
              Change roles' permissions</a></li>
            <li><a th:href="@{/group/change_multiple(groupUid=${group.uid})}">Add, remove multiple members</a></li>
            <li><a th:if="${isPaidFor}" th:href="@{/group/import/start(groupUid=${group.uid})}">Import members</a></li>
            <li><a th:if="${isPaidFor}" th:href="@{/group/copy(groupUid=${group.uid})}">Copy or move members to other group</a></li>
            <li><a href="javascript:void(0)" data-toggle="modal" data-target="#reminderModal">Change reminder timing</a></li>
            <li><a href="javascript:void(0)" data-toggle="modal" data-target="#renameModal">Rename group</a></li>
            <li><a href="javascript:void(0)" data-toggle="modal" data-target="#languageModal">Set default language</a></li>
            <li><a href="" th:href="@{/group/consolidate/select(groupUid=${group.uid})}">Merge with another group</a></li>

            <li><a href="" th:href="@{/group/export/xls(groupUid=${group.uid})}">Export group</a></li>

            <li class="divider"></li>
            <li th:if="${isPaidFor and hasPayPerMessage}">
              <a th:href="@{/group/welcome/messages(groupUid=${group.uid})}">Group welcome messages</a>
            </li>
            <li th:if="${canAddToAccount}" sec:authorize="hasAnyRole('ROLE_ACCOUNT_ADMIN')">
              <a href="javascript:void(0)" data-toggle="modal" data-target="#accountModal">Add group to account</a>
            </li>
            <li th:if="${canRemoveFromAccount}" sec:authorize="hasAnyRole('ROLE_ACCOUNT_ADMIN')">
              <a href="javascript:void(0)" data-toggle="modal" data-target="#accountRemoveModal">Remove group from account</a>
            </li>
            <li th:if="${not hasParent and (canAddToAccount or isPaidFor)}"><a th:href="@{/group/parent(groupUid=${group.uid})}">Link to a parent group</a></li>
            <li th:if="${canCreateSubGroup}"><a th:href="@{/group/create(parent=${group.uid})}">Create a sub-group</a></li>
            <li th:if="${canDeleteGroup}"><a href="javascript:void(0)" data-toggle="modal" data-target="#delModal">Delete group</a></li>
            <li th:unless="${canChangePermissions}"><a href="javascript:void(0)" data-toggle="modal" data-target="#unsubModal">Unsubscribe</a></li>
          </ul>
        </div>

        <div th:unless="${canAlter}" class="dropdown manage-container">
          <button type="button" class="dropdown-toggle white-button group-center-button" data-toggle="modal" data-target="#unsubModal">Unsubscribe</button>
        </div>

      </div>
    </div>

    <div class="row group-description">
      <div class="col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2 col-xs-12">
        <h4 class="text-center">Description</h4>
        <p th:unless="${#strings.isEmpty(group.description)}"><span th:text="${group.description}">Lorem ipsum dolor sit amet, consectetur adispicing elit.
          Duis ac nulla tincidunt, dictum magna sed, mattis elit.</span>
          <a href="#descriptionModal" data-toggle="modal" data-target="#descriptionModal">Change.</a>
        </p>
        <p th:if="${#strings.isEmpty(group.description)}">
          This group has no description. A description helps other people find the group, and members to know what its purpose is.
          <a th:if="${canAlter}" href="#descriptionModal" data-toggle="modal" data-target="#descriptionModal">Add a description now?</a>
        </p>
      </div>
    </div>

    <div class="row tight-vertical">
      <div class="col-md-6 col-md-offset-3 col-sm-8 col-sm-offest-2 col-xs-12">
        <h4 class="group-info text-center">
          <a href="javascript:void(0)" data-toggle="modal" data-target="#aliasModal">
            Change your name in this group
          </a>
        </h4>
      </div>
    </div>

  </div>

</section>

<main layout:fragment="content">

  <!-- Common action buttons -->
  <section class="group-buttons">
    <div class="container">
      <div class="row">
        <div class="col-md-3 col-md-offset-1 text-center">
          <a th:if="${canCallMeeting}" href="" th:href="@{/meeting/create(groupUid=${group.uid})}">
            <button class="white-button group-button"><i class="fa fa-comments-o" aria-hidden="true"></i>Call a meeting</button></a>
        </div>
        <div class="col-md-2">
          <a th:if="${canCallVote}" href="" th:href="@{/vote/create(groupUid=${group.uid})}">
            <button class="white-button group-button"><i class="fa fa-hand-pointer-o" aria-hidden="true"></i>Take a vote</button></a>
        </div>
        <div class="col-md-3">
          <a th:if="${canRecordAction}" href="" th:href="@{/todo/create(parentUid=${group.uid})}">
            <button class="white-button group-button"><i class="fa fa-users" aria-hidden="true"></i>Record action</button></a>
        </div>
        <div class="col-md-2">
          <a th:href="@{/group/history(groupUid=${group.uid})}">
            <button class="white-button group-button"><i class="fa fa-list-ol" aria-hidden="true"></i>View history</button></a>
        </div>
      </div>
    </div>
  </section>

  <!-- List upcoming group tasks -->
  <section class="group-tasks-list" th:if="${not #lists.isEmpty(groupTasks)}">
    <div class="container">
      <div class="row">
        <div class="col-md-10 col-md-offset-1 col-xs-12">
          <div class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title" th:switch="${groupTasks.size()}">
                  <a data-toggle="collapse" href="#collapse1" class="panel-title-text">
                    <span th:case="0" th:text="#{web.group.view.tasks.zero}">This group has no events coming up</span>
                    <span th:case="1" th:text="#{web.group.view.tasks.one(${groupTasks.get(0).type})}">This group has one thing coming up</span>
                    <span th:case="*" th:text="#{web.group.view.tasks.many(${groupTasks.size()})}">This group has many things happening</span>
                    <i class="fa fa-caret-down" aria-hidden="true"></i>
                  </a>
                </h4>
              </div>

              <div id="collapse1" class="panel-collapse collapse in">
                <ul class="list-group" >
                  <li class="list-group-item" th:each="task, iterStat : ${groupTasks}">
                    <div class="row" th:switch="${task.type}" th:with="uid=${task.taskUid}">

                      <div th:case="MEETING"  th:with="deadline=${#temporals.format(task.deadlineDateTime,'dd MMM, HH:mm')}">
                        <div class="col-md-8 event-item">
                          <a class="list-header" href="" th:href="@{/meeting/view(eventUid=${uid}, source='GROUP')}">
                            <b>MEETING:</b> <span th:text="${task.title}"></span>
                          </a>
                        </div>
                        <div class="col-md-4 button-md-align">
                          <span th:if="${task.hasResponded}" class="badge">Happens at <span th:text="${deadline}">11 September 2015</span></span>
                          <a th:unless="${task.hasResponded}" th:href="@{/meeting/rsvp(eventUid=${uid},answer=yes)}" class="btn default-button btn-positive">I'll attend</a>
                          <a th:unless="${task.hasResponded}" th:href="@{/meeting/rsvp(eventUid=${uid},answer=no)}" class="btn default-button btn-negative">I can't attend</a>
                        </div>
                      </div>

                      <div th:case="VOTE" th:with="deadline=${#temporals.format(task.deadlineDateTime, 'dd MMM, HH:mm')}">
                        <div class="col-md-8 event-item">
                          <a class="list-header" href="" th:href="@{/vote/view(eventUid=${task.taskUid}, source='GROUP')}">
                            <b>VOTE:</b> <span th:text="${task.title}"></span>
                          </a>
                        </div>
                        <div class="col-md-4" th:classappend="${task.hasResponded} ? 'badge' : 'button-md-align'">
                          <span th:if="${task.hasResponded}">Closes <span th:text="${deadline}">11 September 2015</span></span>
                          <div th:unless="${task.hasResponded}">
                            <div th:if="${#lists.isEmpty(task.getTags())}">
                              <a th:href="@{vote/answer(eventUid=${task.taskUid},answer=YES)}" class="btn default-button btn-positive">Vote yes</a>
                              <a th:href="@{vote/answer(eventUid=${task.taskUid},answer=NO)}" class="btn default-button btn-negative">Vote no</a>
                              <a th:href="@{vote/answer(eventUid=${task.taskUid},answer=ABSTAIN)}" class="btn default-button btn-neutral">Abstain</a>
                            </div>
                            <div th:if="${not #lists.isEmpty(task.tags)}">
                              <select name="answer" class="form-control vote-selector" th:attr="data-uid=${task.taskUid}">
                                <option value="NULL">Cast your vote ...</option>
                                <option th:each="option: ${task.tags}" th:value="${option}" th:text="${option}">
                                </option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div th:case="TODO" th:with="deadline=${#temporals.format(task.deadlineDateTime,'EEE d MMM')}">
                        <div class="col-md-8 event-item">
                          <a class="list-header" href="" th:href="@{/todo/view(todoUid=${task.taskUid}, source='GROUP')}"><b>TODO:</b>
                          <span th:text="${task.title}"></span> (due <span th:text="${#temporals.format(task.deadlineDateTime, 'd MMM')}">11 Sep 2015</span>)</a>
                        </div>
                        <div th:unless="${task.hasResponded}" class="col-md-4 button-md-align">
                          <a th:href="@{/todo/complete(todoUid=${task.taskUid})}" class="btn default-button btn-positive">Mark as completed</a>
                        </div>
                        <div th:if="${task.hasResponded}" class="col-md-4 badge">
                          You've marked the action done
                        </div>
                      </div>

                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- List group members -->
  <section class="group-members" th:unless="${#lists.isEmpty(groupMembers)}">
    <div class="container">
      <div class="row vertical-padding" th:if="${atGroupSizeLimit}">
        <div class="alert grassroot-alert alert-warning col-md-10 col-md-offset-1">
          <p class="alert-lg">
            <span th:if="${canAddToAccount}">This group has reached the size limit for free groups. To add members, you
              will need to <a href="javascript:void(0)" data-toggle="modal" data-target="#accountModal">add it to your account</a>.</span>
            <span th:if="${canRemoveFromAccount}">This group has reached the size limit for your type of account. To
              add more members, <a th:href="@{/account/type}">please upgrade your account</a>.</span>
            <span th:if="${hasAccount and !canAddToAccount and !canRemoveFromAccount}">This group has reached its size limit and you do not have
              space left on your account or it is disabled. Please <a th:href="@{/account}">enable or upgrade it</a>
              and add the group if you want to add members.</span>
            <span th:if="${!hasAccount}">This group has reached the size limit for free
              groups. To add members, <a th:href="@{/account/signup}">please sign up for an account</a>.</span>
          </p>
        </div>
      </div>

      <div class="row">
        <div class="col-md-8 col-md-offset-1 col-xs-12">
          <h4 class="green-title">Group members</h4>
        </div>
        <div th:if="${canAddMembers}" class="col-md-2 col-xs-12 text-right">
          <button type="button" class="main-button" data-toggle="modal" data-target="#addModal">
            <i class="fa fa-plus" aria-hidden="true"></i>Add member</button>
        </div>
      </div>

      <div class="row group-members-list">
        <div class="col-md-10 col-md-offset-1">
          <div class="panel-group">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a data-toggle="collapse" href="#collapse2">
                    List of group members
                    <i class="fa fa-caret-up" aria-hidden="true"></i>
                  </a>
                </h4>
              </div>
              <div id="collapse2" class="panel-collapse collapse in">
                <table id="card-table" class="table group-members-table">
                  <thead>
                    <tr>
                      <th class="col-md-3">Name</th>
                      <th class="col-md-3">Phone number</th>
                      <th class="col-md-3">Role in group</th>
                      <th class="col-md-2"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="member : ${groupMembers}">
                      <td class="col-md-3">
                        <span th:unless="${#strings.isEmpty(member.displayName)}" th:text="${member.displayName}">User name</span>
                        <span th:if="${#strings.isEmpty(member.displayName)}">Unnamed</span>
                        <span th:unless="${member.userSetName or not canAlter}">
                          <a href="javascript:void(0)" data-toggle="modal" data-target="#editNameModal" th:attr="data-phone=${member.phoneNumber}">(edit)</a>
                        </span>
                      </td>
                      <td class="col-md-3"><span th:text="${member.getNationalFormattedNumber()}">Phone number</span></td>
                      <td class="col-md-3"><span th:text="#{web.group.role.__${member.roleName}__}">Role name</span></td>
                      <td class="col-md-2 text-center remove-button">
                          <button th:if="${canDeleteMembers}" data-toggle="modal" data-target="#rmModal" th:attr="data-phone=${member.getPhoneNumberWithCCode()}"
                                  th:unless="${member.getPhoneNumberWithCCode() == currentUser.getUsername()}">
                            <i class="fa fa-times" aria-hidden="true"></i>Remove
                          </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- list subgroups -->
  <section th:if="${not #lists.isEmpty(subGroups)}" class="group-member">
      <div class="container">
        <div class="row">
          <div class="col-md-10 col-md-offset-1">
            <div class="row">
              <h4 class="green-title">Subgroups</h4>
            </div>
            <div class="row">
              <div th:each="subgroup, iterStat : ${subGroups}" class="bs-component">
                <div class="list-group">
                  <div class="list-group-item">
                    <div class="row-content">
                      <h4  class="list-group-item-heading">
                        <a th:href="@{/group/view(groupUid=${subgroup.Uid})}"><span th:text="${subgroup.groupName}"></span></a>
                      </h4>
                      <div class="least-content"><span th:text="${subgroup.getMembers().size()}"></span> Members</div>
                      <p class="list-group-item-text">Est. <span th:text="${#temporals.format(subgroup.getCreatedDateTimeAtSAST(),'dd MMMM yyyy')}">13 May 2011</span></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </section>

  <!-- MODALS -->

  <!-- alias modal -->
  <div class="modal fade" id="aliasModal" tabindex="-1" role="dialog" aria-labelledby="aliasModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="aliasModalLabel">Change my name in group</h4>
        </div>
        <form th:action="@{/group/alias}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.uid}" />
          <div class="modal-body">
            <div class="form-group">
              <label for="new-group-name" class="control-label">What name will you use in this group? (leave it
              blank to reset to your normal name)</label>
            </div>
            <div class="form-group">
              <input type="text" class="form-control input-lg" id="alias" name="alias"
                     th:placeholder="${displayName}"/>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Rename</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Joining code modal -->
  <div th:if="${canAlter}" class="modal fade" id="joiningModal" tabindex="-1" role="dialog" aria-labelledby="joiningModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="joiningModalLabel">Manage joining code</h4>
        </div>
        <form th:action="@{/group/token}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
          <div class="modal-body">
            <div class="form-group" th:if="${openToken}">
              <p>Close joining code? If you confirm, then anyone using the code from now on will not be added to the group.</p>
            </div>
            <div class="form-group" th:unless="${openToken}">
              <p>A joining code allows anyone to join your group just by typing it into their phone. You can close it anytime. Continue?</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Confirm</button>
          </div>
        </form>
      </div>
    </div>
  </div>

    <!-- Public / private modal -->
  <div th:if="${canAlter}" class="modal fade" id="publicModal" tabindex="-1" role="dialog" aria-labelledby="publicModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="publicModalLabel">
            <span th:if="${group.discoverable}">Take group private</span>
            <span th:unless="${group.discoverable}">Make group public</span>
          </h4>
        </div>
        <form th:action="@{/group/discoverable}" method="get">
          <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
          <div class="modal-body">
            <div class="form-group" th:if="${group.discoverable}">
              <p>Make group private? If you confirm, non-members will no longer be able to find your group by searching for it.
              Note: join requests are currently approved by <span th:text="${group.joinApprover.displayName}">name</span></p>
            </div>
            <div class="form-group" th:unless="${group.discoverable}">
              <p>Making the group public will allow non-members to see it on search results, and request to join. To proceed,
                please select which organizer will be responsible for approving or rejecting join requests:</p>
            </div>
            <div class="form-group" th:unless="${group.discoverable}">
              <select class="form-control input-lg" id="authorizing-member" name="approverPhoneNumber">
                <option th:each="member : ${groupMembers}"
                        th:if="${member.roleName == 'ROLE_GROUP_ORGANIZER'}"
                        th:value="${member.getPhoneNumberWithCCode()}"
                        th:text="${member.displayName}"></option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Confirm</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Unsubscribe modal -->
  <div th:unless="${canAlter}" class="modal fade" id="unsubModal" tabindex="-1" role="dialog" aria-labelledby="unsubModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="unsubModalLabel">Are you sure?</h4>
        </div>
        <form th:action="@{/group/unsubscribe}" method="post">
          <input type="hidden" name="groupUid" id="groupUid" th:value="${group.uid}" />
          <div class="modal-body">
            <div class="form-group">
              <p>You are about to unsubscribe from this group. You will only be able to rejoin if someone adds you back. Are you sure you want to leave? Please type
                'unsubscribe' below to confirm.</p>
              <input type="text" class="form-control input-lg" id="confirm_unsub_field" name="confirm_field" autocomplete="off" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-warning btn-lg default-button">Unsubscribe</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Add group to account modal -->
  <div th:if="${canAddToAccount}" class="modal fade" id="accountModal" tabindex="-1" role="dialog" aria-labelledby="accountModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="accountModalLabel">Link group to account?</h4>
        </div>
        <form th:action="@{/group/account/add}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.uid}" />
          <div class="modal-body">
            <div class="form-group">
              <p>You have <span th:text="${accountGroupsLeft}">X</span> groups left you can add to your account. Add this one?.</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Confirm</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Remove group from account modal -->
  <div th:if="${canRemoveFromAccount}" class="modal fade" id="accountRemoveModal" tabindex="-1" role="dialog" aria-labelledby="accRemoveModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="accRemoveModalLabel">Link group to account?</h4>
        </div>
        <form th:action="@{/group/account/remove}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.uid}" />
          <div class="modal-body">
            <div class="form-group">
              <p>Are you sure? If you remove this group from your account, it will no longer have access
              to account features (Excel import, extra actions, etc).</p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Confirm</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Rename group modal -->
  <div th:if="${canAlter}" class="modal fade" id="renameModal" tabindex="-1" role="dialog" aria-labelledby="renameModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="renameModalLabel">Rename group</h4>
        </div>
        <form th:action="@{/group/rename}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
          <div class="modal-body">
            <div class="form-group">
              <label for="new-group-name" class="control-label">New group name:</label>
            </div>
            <div class="form-group">
              <input type="text" class="form-control input-lg" id="new-group-name"
                     name="groupName" th:placeholder="${group.groupName}"/>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Rename</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Group description modal -->
  <div th:if="${canAlter}" class="modal fade" id="descriptionModal" tabindex="-1" role="dialog" aria-labelledby="descriptionModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="descriptionModalLabel">Change description</h4>
        </div>
        <form th:action="@{/group/description}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.uid}" />
          <div class="modal-body">
            <div class="form-group">
              <label for="groupDescription" class="control-label">Set a description for the group (one to three sentences):</label>
            </div>
            <div class="form-group">
              <textarea name="groupDescription" th:text="${group.description}" id="groupDescription" class="form-control input-lg" rows="2" maxlength="250">
              </textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn default-button">Update</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Change group language modal -->
  <div th:if="${canAlter}" class="modal fade" id="languageModal" tabindex="-1" role="dialog" aria-labelledby="languageModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="languageModalLabel">Change group language</h4>
        </div>
        <form th:action="@{/group/language}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
          <div class="modal-body">
            <div class="form-group">
              <label for="group-locale" class="control-label">Select language:</label>
              <select name="locale" id="group-locale" class="form-control input-lg">
                <option th:each="language: ${T(za.org.grassroot.webapp.controller.BaseController).getImplementedLanguages()}"
                        th:value="${language.key}"
                        th:text="${language.value}"></option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Set</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Change default reminder setting modal -->
  <div th:if="${canAlter}" class="modal fade" id="reminderModal" tabindex="-1" role="dialog" aria-labelledby="reminderModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="reminderModalLabel">When will reminders be sent?</h4>
        </div>
        <form th:action="@{/group/reminder}" method="get">
          <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
          <div class="modal-body">
            <div class="form-group">
              <p>This will set when reminders for meetings and to-dos will be sent out automatically, unless a custom time
              is set when the meeting is called or to-do is recorded</p>
            </div>
            <div class="form-group">
              <select name="reminderMinutes" id="reminderMinutes" class="form-control input-lg">
                <option th:each="option : ${reminderOptions}"
                        th:value="${option[0]}"
                        th:text="${option[1]}"
                        th:selected="${#strings.equals(group.getReminderMinutes(), option[0])}"></option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Update</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Make group inactive modal -->
  <div th:if="${canDeleteGroup}" class="modal fade" id="delModal" tabindex="-1" role="dialog" aria-labelledby="delModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="delModalLabel">Are you sure?</h4>
        </div>
        <form th:action="@{/group/inactive}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
          <div class="modal-body">
            <div class="form-group">
              You are about to remove this group. This cannot be undone. To confirm, please type "delete" below".
            </div>
            <div class="form-group">
              <input type="text" class="form-control input-lg" id="confirm_field"
                     name="confirm_field" autocomplete="off" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-danger btn-lg default-button btn-neutral">Confirmed, remove</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Remove member modal -->
  <div th:if="${canDeleteMembers}" class="modal fade" id="rmModal" tabindex="-1" role="dialog" aria-labelledby="rmModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="removeModalLabel">Are you sure?</h4>
          </div>
          <form th:action="@{/group/remove}" method="post">
            <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
            <input type="hidden" name="msisdn" id="msisdn" value="ABC" />
            <div class="modal-body">
                <div class="form-group">
                  You are about to remove a member from the group. Proceed?
                </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-warning btn-lg default-button btn-negative">Remove</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  <!-- Add member modal -->
  <div th:if="${canAddMembers}" class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="addModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="addModalLabel">Add member to group</h4>
          </div>
          <form th:action="@{/group/addmember}" id="add_member_form" method="post">
            <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
            <div class="modal-body">
              <div class="form-group">
                <label for="newMemberName" class="control-label">Name</label>
                <input type="text" class="form-control input-lg" id="newMemberName" name="displayName" />
              </div>
              <div class="form-group">
                <label for="newMemberPhone" class="control-label">Phone number</label>
                <input type="text" class="form-control input-lg" id="newMemberPhone" name="phoneNumber" />
              </div>
              <div class="form-group">
                <label for="new-member-role" class="control-label">Role</label>
                <select class="form-control input-lg" id="new-member-role" name="roleName">
                <option th:each="role : ${T(za.org.grassroot.core.domain.BaseRoles).groupRoles}"
                        th:value="${role}"
                        th:text="#{web.group.role.__${role}__}"></option>
                </select>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary btn-lg default-button">Add</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  <!-- Edit group name modal -->
  <div th:if="${canAlter}" class="modal fade" id="editNameModal" tabindex="-1" role="dialog" aria-labelledby="editNameModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="editNameModal">Edit name</h4>
        </div>
        <form th:action="@{/group/rename_member}" method="post">
          <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
          <input type="hidden" name="phoneNumber" id="phoneNumber" value="ABC" />
          <div class="modal-body">
            <div class="form-group">
              <label for="new-name" class="control-label">Please enter a new name:</label>
              <input type="text" class="form-control" id="new-name" name="displayName" />
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-warning btn-lg default-button">Change</button>
          </div>
        </form>
      </div>
    </div>
  </div>


  <!-- Modal to generate flyer -->
  <div th:if="${openToken and not #lists.isEmpty(flyerLanguages)}"
       class="modal fade" id="flyerModal" tabindex="-1" role="dialog" aria-labelledby="flyerModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="flyerModalLabel">Generate group flyer</h4>
        </div>
        <form th:action="@{/group/flyer}" method="get">
          <div class="modal-body">
            <input type="hidden" name="groupUid" th:value="${group.getUid()}" />
            <div class="form-group">
              <select class="form-control input-lg" name="color">
                <option value="true">Colour</option>
                <option value="false">Black and white</option>
              </select>
            </div>
            <div class="form-group">
              <select class="form-control input-lg" name="language">
                <option th:each="language : ${flyerLanguages}"
                        th:value="${language.getDisplayLanguage()}"
                        th:text="${language.getDisplayLanguage()}"></option>
              </select>
            </div>
            <div class="form-group">
              <select class="form-control input-lg" name="typeOfFile">
                <option value="PDF">PDF</option>
                <option value="JPEG">Image (jpg)</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-lg default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-lg default-button">Generate</button>
          </div>
        </form>

      </div>
    </div>
  </div>

  <div th:if="${not #lists.isEmpty(groupTasks)}" class="modal fade" id="voteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="voteConfirmModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">x</span></button>
          <h4 class="modal-title" id="voteConfirmModalTitle">Confirm vote</h4>
        </div>
        <form th:action="@{/vote/answer}" method="get">
          <input type="hidden" id="eventUid" name="eventUid" />
          <input type="hidden" id="answer" name="answer" />
          <div class="modal-body">
            <div class="form-group">
              <p>
                You are about to cast your vote for <span class="bold" id="responseText"></span>. Are you sure?
              </p>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn default-button btn-neutral" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn default-button">Vote</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</main>

<div layout:fragment="script-container">

  <script th:src="@{/js/lib/stacktable.min.js}"></script>

  <script th:src="@{/js/lib/jquery-ui.min.js}"></script>
  <script th:src="@{/js/lib/jquery.validate.min.js}"></script>

  <script>

    $('#rmModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var phone = button.data('phone');
      var modal = $(this);
      modal.find('#msisdn').val(phone);
    });

    $('#editNameModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var phone = button.data('phone');
      var modal = $(this);
      modal.find('#phoneNumber').val(phone);
    });

    $('#addModal').on('show.bs.modal', function(event) {
      var nameInput = $('#newMemberName');
      var phoneInput = $('#newMemberPhone');
      nameInput.autocomplete(grassrootJS.memberAutoComplete(nameInput, phoneInput));
    });

    $(document).ready(function () {

      grassrootJS.setUpAjax($("meta[name='_csrf']"), $("meta[name='_csrf_header']"));

      $('#card-table').cardtable();

      $('#add_member_form').validate({
        errorClass: "error-text",
        rules: {
          phoneNumber: grassrootJS.phoneRules
        }
      });

      $(".vote-selector").click(function() {
        var optionSelected = $(this).find('option:selected').val();
        console.log("optionSelected = " + optionSelected);
        if (optionSelected !== "NULL") {
          var confirmModal = $("#voteConfirmModal");
          confirmModal.find("#eventUid").val($(this).data('uid'));
          confirmModal.find("#answer").val(optionSelected);
          confirmModal.find("#responseText").text(optionSelected);
          confirmModal.modal();
        }
      });

      $( ".group-members .panel-title a" ).click(function() {
        $( ".group-members .panel-title a i" ).toggleClass( "flip-icon" );
      });

    });

  </script>
</div>


</body>
</html>